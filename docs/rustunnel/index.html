<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="`rustunnel` is a sandboxed TLS tunnel library."><meta name="keywords" content="rust, rustlang, rust-lang, rustunnel"><title>rustunnel - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script id="default-settings" ></script><script src="../storage.js"></script><script src="../crates.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../rustunnel/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><h2 class="location">Crate rustunnel</h2><div class="block version"><div class="narrow-helper"></div><p>Version 0.1.2</p></div><div class="sidebar-elems"><a id="all-types" href="all.html"><p>See all rustunnel's items</p></a><div class="block items"><ul><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li></ul></div><div id="sidebar-vars" data-name="rustunnel" data-ty="mod" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../brush.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../wheel.svg"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">rustunnel</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/rustunnel/lib.rs.html#8-370" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p><code>rustunnel</code> is a sandboxed TLS tunnel library.</p>
<p>This library can either <a href="struct.ServerChild.html">accept</a> or <a href="struct.ClientChild.html">initiate</a> a TLS connection inside a process sandbox.
A process utilizing this library should be minimal, limited in scope, and single-threaded, so as to not open any
unforeseen security holes or cause sandbox violations.</p>
<h2 id="portability" class="section-header"><a href="#portability">Portability</a></h2>
<p>Currently only Linux is supported, using <code>libseccomp2</code> for process sandboxing.</p>
<h2 id="usage" class="section-header"><a href="#usage">Usage</a></h2>
<p>Care should be taken in the sandboxed process to clear all secrets in memory before starting the sandboxed TLS
connection, e.g. loaded TLS private keys. The <a href="clear_on_drop"><code>clear_on_drop</code></a> crate can be used to clear secrets automatically.
<a href="tls/struct.Identity.html#method.from_pkcs12_file" title="Identity::from_pkcs12_file"><code>Identity::from_pkcs12_file</code></a> provides an implementation of loading a TLS private key while clearing all secrets in
memory.</p>
<p>The <code>log</code> implementation used in the sandboxed process should take care not to perform any system calls while
writing log message which may be disallowed by the process sandbox. Calculating timestamps, for example, may use a
prohibited system call. <a href="logger/struct.Logger.html" title="logger::Logger"><code>logger::Logger</code></a> provides a conforming implementation (without timestamps) which writes to
the standard error.</p>
<p>It is recommended that <a href="sandbox/fn.close_all_fds.html" title="sandbox::close_all_fds"><code>sandbox::close_all_fds</code></a> be called, as immediately as possible, before running the
sandboxed TLS connection, to ensure no additional file descriptors are unintentionally opened in the interim.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">rustunnel</span>::{<span class="ident">tls</span>, <span class="ident">ServerChild</span>};
<span class="kw">use</span> <span class="ident">std::net::TcpListener</span>;
<span class="kw">use</span> <span class="ident">std::os::unix::io::AsRawFd</span> <span class="kw">as</span> <span class="kw">_</span>;
<span class="kw">use</span> <span class="ident">std::path::Path</span>;

<span class="kw">let</span> (<span class="ident">source_tcp_stream</span>, <span class="kw">_</span>) <span class="op">=</span> <span class="ident">TcpListener::bind</span>(<span class="string">&quot;127.0.0.1:8080&quot;</span>)<span class="question-mark">?</span>.<span class="ident">accept</span>()<span class="question-mark">?</span>;
<span class="kw">let</span> <span class="ident">identity</span> <span class="op">=</span> <span class="ident">tls::Identity::from_pkcs12_file</span>(<span class="ident">Path::new</span>(<span class="string">&quot;/path/to/identity.p12&quot;</span>), <span class="string">&quot;pkcs12 password&quot;</span>)<span class="question-mark">?</span>;
<span class="kw">let</span> <span class="ident">target_pipe_stream</span> <span class="op">=</span> <span class="ident">rustunnel::stream::ProxyPipeStream::stdio</span>()<span class="question-mark">?</span>;

<span class="kw">let</span> <span class="ident">source_fd</span> <span class="op">=</span> <span class="ident">source_tcp_stream</span>.<span class="ident">as_raw_fd</span>();
<span class="kw">let</span> <span class="ident">allow_fds</span> <span class="op">=</span> [<span class="ident">libc::STDIN_FILENO</span>, <span class="ident">libc::STDOUT_FILENO</span>, <span class="ident">libc::STDERR_FILENO</span>, <span class="ident">source_fd</span>];
<span class="ident">rustunnel::sandbox::close_all_fds</span>(<span class="kw-2">&amp;</span><span class="ident">allow_fds</span>.<span class="ident">iter</span>().<span class="ident">cloned</span>().<span class="ident">collect</span>());

<span class="kw">let</span> <span class="ident">child</span> <span class="op">=</span> <span class="ident">ServerChild::new</span>(<span class="ident">tls::CaCertificate::System</span>, <span class="ident">identity</span>, <span class="ident">source_tcp_stream</span>, <span class="ident">target_pipe_stream</span>)<span class="question-mark">?</span>;
<span class="ident">child</span>.<span class="ident">run</span>()<span class="question-mark">?</span>;</code></pre></div>
</div></details><h2 id="modules" class="section-header"><a href="#modules">Modules</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="mod" href="logger/index.html" title="rustunnel::logger mod">logger</a></div><div class="item-right docblock-short"><p>Logging utilities for use with a sandboxed process.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="sandbox/index.html" title="rustunnel::sandbox mod">sandbox</a></div><div class="item-right docblock-short"><p>Process sandbox utilities.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="stream/index.html" title="rustunnel::stream mod">stream</a></div><div class="item-right docblock-short"><p>Streams for use with sandboxed TLS connections.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="tls/index.html" title="rustunnel::tls mod">tls</a></div><div class="item-right docblock-short"><p>TLS-related types.</p>
</div></div></div><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ClientChild.html" title="rustunnel::ClientChild struct">ClientChild</a></div><div class="item-right docblock-short"><p>A sandboxed TLS initiator.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ServerChild.html" title="rustunnel::ServerChild struct">ServerChild</a></div><div class="item-right docblock-short"><p>A sandboxed TLS acceptor.</p>
</div></div></div></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../" data-current-crate="rustunnel" data-search-index-js="../search-index.js" data-search-js="../search.js"></div>
    <script src="../main.js"></script>
</body></html>